```{python}
import pandas as pd
import plotly.express as px
car_theft_data = pd.read_csv('../../data/clean/crime_dc.csv')



# Convert 'report_date' to datetime format
car_theft_data['report_date'] = pd.to_datetime(car_theft_data['report_date'], format='%Y-%m-%dT%H:%M:%SZ')

# Extract year from 'report_date'
car_theft_data['year'] = car_theft_data['report_date'].dt.year

# Exclude data for the year 2024
car_theft_data = car_theft_data[car_theft_data['year'] != 2024]

# Extract hour of the day from 'report_date' and convert to 12-hour format with AM/PM
car_theft_data['hour_of_day'] = car_theft_data['report_date'].dt.strftime('%I %p')

# Count the number of car thefts for each year and hour of the day
yearly_hourly_theft_counts = car_theft_data.groupby(['year', 'hour_of_day']).size().reset_index(name='Number of Car Thefts')

# Define order of hours
hour_order = ['12 AM', '01 AM', '02 AM', '03 AM', '04 AM', '05 AM', '06 AM', '07 AM', 
              '08 AM', '09 AM', '10 AM', '11 AM', '12 PM', '01 PM', '02 PM', '03 PM', 
              '04 PM', '05 PM', '06 PM', '07 PM', '08 PM', '09 PM', '10 PM', '11 PM']

# Convert 'hour_of_day' to categorical with the defined order
yearly_hourly_theft_counts['hour_of_day'] = pd.Categorical(yearly_hourly_theft_counts['hour_of_day'], categories=hour_order, ordered=True)

# Sort the dataframe by 'hour_of_day' and 'year' to ensure it's displayed in chronological order
yearly_hourly_theft_counts = yearly_hourly_theft_counts.sort_values(by=['year', 'hour_of_day'])

# Plot the data
fig = px.line(yearly_hourly_theft_counts, x='hour_of_day', y='Number of Car Thefts', color='year',
              labels={'hour_of_day': 'Hour of the Day', 'Number of Car Thefts': 'Number of Car Thefts', 'year': 'Year'},
              color_discrete_sequence=r.color_palette)

# Adjust layout to slant x-label ticks
fig.update_layout(xaxis_tickangle=45)
```
