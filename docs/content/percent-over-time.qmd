```{python}
import altair as alt
import pandas as pd

# Load the data into a DataFrame
kia_hyundai = pd.read_csv("../../data/clean/kia_hyundia_thefts.csv")

kia_hyundai_long = kia_hyundai.groupby(["month", "year"]).agg(
    count_kia_hyundai=pd.NamedAgg(column="count_kia_hyundai", aggfunc="sum"),
    count_all=pd.NamedAgg(column="count_all", aggfunc="sum"),
).reset_index()

kia_hyundai_long["percent_kia_hyundai"] = (
    kia_hyundai_long["count_kia_hyundai"] / kia_hyundai_long["count_all"]
)
kia_hyundai_long["percent_all"] = (
    (kia_hyundai_long["count_all"] - kia_hyundai_long["count_kia_hyundai"])
    / kia_hyundai_long["count_all"]
)

kia_hyundai_long["date"] = pd.to_datetime(
    kia_hyundai_long["month"].astype(str)
    + "-"
    + kia_hyundai_long["year"].astype(str)
    + "-01"
)

# pivot longer
kia_hyundai_long = kia_hyundai_long.melt(
    id_vars=["date", "month", "year", "count_kia_hyundai", "count_all"],
    value_vars=["percent_kia_hyundai", "percent_all"],
    var_name="type",
    value_name="percent",
)

kia_hyundai_long["type"] = kia_hyundai_long["type"].replace(
    {
        "percent_kia_hyundai": "Kia/Hyundai",
        "percent_all": "Other",
    }
)

# select date through brsuh
brush = alt.selection_interval(encodings=["x"], name="select")

# create the base line plot
line = alt.Chart(kia_hyundai_long).mark_line(point=True).encode(
    x=alt.X("date:T", title="Date"),
    y=alt.Y("count_kia_hyundai:Q", title="Number of Kia and Hyundai Thefts"),
    color=alt.value("#493FB3"),
    tooltip=[alt.Tooltip("date:T", title="Date", format = "%B %Y"), alt.Tooltip("count_kia_hyundai:Q", title = "Number of Kia and Hyundai Thefts", format = ",")],
).properties(width=500, height=300).add_params(brush)

radial = alt.Chart(kia_hyundai_long).mark_arc(innerRadius=50).encode(
    theta="mean(percent):Q",
    color=alt.Color("type:N", scale=alt.Scale(range=["#493FB3", "#FF8C00"]), title = "Car Make"),
    tooltip = [alt.Tooltip("mean(percent):Q", title = "Average Percent", format = ".1%"), alt.Tooltip("type:N", title = "Type")],
).transform_filter(
    brush
).properties(
    width=300, height=300
)




# show all points on the same chart
alt.hconcat(line, radial).resolve_scale(
    color="independent"
    # add title
).properties(
    title="Kia and Hyundai Thefts as a Percentage of Car Thefts\nin U.S. Cities from 2019 to 2023",
).configure_axis(
    labelFontSize=12,
    titleFontSize=12,
).configure_legend(
    labelFontSize=12,
    titleFontSize=12,
).configure_title(
    fontSize=16,
    anchor="middle",
).configure_view(
    strokeWidth=0,
).configure_concat(
    spacing=20,
)
```